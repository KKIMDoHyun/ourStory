# OurStory

## 2021-09-13

### <활동>

- 프로젝트 생성 및 환경 구성(vuetify, eslint 등)
- strapi를 활용하여 가상 DB 구축
- 회원가입 및 로그인 기능 구현

### <막혔던 점>

- strapi를 처음 사용해봤기 때문에 공부하는데 시간이 오래걸렸다.
- 회원가입을 진행할 때 strapi의 어떤 주소로 데이터를 post 해야되는지 헤맸다.
- 로그인을 할 때 토큰을 받아와서 저장해야 되는데, 값이 계속 빈 값으로 들어갔다. 또한 새로고침을 하면 로그인 상태가 유지되지 않았다.

> 해결: strapi에서 처음으로 제공되는 주소인 /auth/local로 post를 하면 로그인이 되고, /auth/local/register로 post를 하면 회원가입이 되었다. 이를 이용하여 로그인 및 회원가입을 구현하였다. 로그인을 할 때 store에 있는 빈 token값이 먼저 저장되고 로그인이 되어서 빈 값이 나온 것이었다. 이를 axios의 interceptors를 이용하여 먼저 store에 값을 저장하고 이 값을 headers에 넣어주도록 하였다. 로그인 상태를 유지시키기 위해서 localStorage에 저장하는 방법과 쿠키를 저장하는 방법이 있는데, localStorage는 보안상 쿠키보다 덜 하기 때문에 쿠키에 저장하는 방법을 택했다.
---

## 2021-09-14

### <활동>

- 로그인 시 사용자의 고유 id값을 쿠키에 저장하고 이 쿠키를 이용하여 사용자 정보를 가져와서 뿌려줌
- 쿠키에도 사용자 정보를 저장함(필요한지 고민 중)

### <막혔던 점>

- 사용자 정보를 가져올 때 api파일에 주소를 설정하고 store의 actions에서 api를 불러온 뒤 myPage에서 dispatch를 이용하여 데이터를 가져오려 했는데, 인증되지 않았다는 오류가 떠서 하지 못했다. 

> 해결: 우선 myPage에서 created에 axios.get으로 사용자 정보를 가져와서 뿌려주었다. store의 actions를 이용한 비즈니스 로직으로 바꾸는 작업을 생각해봐야겠다.

---

## 2021-09-15

### <활동>

- TopBar 디자인 변경
- 로그인과 회원가입을 모달 창으로 띄우도록 구조 바꿈
- myPage 들어갈 때 spinner 적용
- 사용자 정보 받아오는 것을 mixin으로 만듦

### <막혔던 점>

- store에 isLoading값을 설정하고 spinner를 router의 berforeEnter에서 다루려고 했지만 잘 되지 않았다.

> 해결: 일단 myPage 부분에서 유저정보를 받아오기 전에 true로 놓고 받아오고 나서 false로 설정하여 해결하였다.

---

## 2021-09-16

### <활동>

- 사용자 정보 받아올 때 Spinner 적용 (App.vue에서 받아옴)
- 메인화면에서 방 리스트 불러오고 입장 시 비밀번호 입력하도록 구현

### <막혔던 점>

- Spinner를 적용할 때 각각 적용하면 됐지만, 매번 하는 것보단 이를 App.vue에 놓는 것이 효율적이라 생각해서 해봤지만 계속 에러가 발생했다.

> 해결: event bus를 이용해서 router의 beforeEnter에서 데이터를 불러올때 스피너를 시작하고 데이터를 다 가져오면 mounted에서 스피너를 종료시켰다.

---

## 2021-09-17

### <활동>

- 방 만들기 기능 추가
- 방에 들어갈 때 비밀번호를 입력하고 비밀번호가 일치해야만 방으로 들어갈 수 있도록 함
- 방에 들어가면 방의 정보를 뿌려줌
- strapi의 rooms에서 방을 만들면 만든 사람의 정보를 leader값에 바로 넣어주도록 코드를 추가함

### <막혔던 점>

- 방의 비밀번호를 입력할 때 strapi에서 password를 설정했지만 비밀번호의 일치 여부 확인 하는 법을 찾지 못했다. 또한 방을 만들 때 token으로 인증된 회원만 만들 수 있도록 하였는데, token을 interceptors를 이용해서 config에 넣었지만 잘 되지 않았다.

> 해결: 일단 password 필드 대신 text 필드로 비밀번호를 등록하도록 하여 일치 여부를 확인하였다. strapi 공식문서를 보니 strapi는 token을 넣고 인증할 때 앞에 Bearer를 붙여야만 읽고 인증이 되는 구조였다. (i.e. `Bearer ${token값}`과 같은 구조)

---

## 2021-09-18

### <활동>

- 방에 들어갔을 때의 UI 구현
- 방에서 게시글 최신순으로 보여주기 완료
- 게시글 작성하기 진행 중

### <막혔던 점>

- 방의 DB인 rooms와 게시글의 DB인 posts를 어떻게 연결을 해야할 지 고민이 되었다. 처음에는 rooms에 저장된 posts들을 불러왔지만 만약 새로 post를 추가했을 때에는 rooms에 추가가 되지 않기 때문에 문제가 발생했다.

> 해결: 해결방안으로 posts를 다 불러온 뒤 내가 들어간 방의 id와 post들에 저장된 room의 id를 비교하여 같은 것들만 저장시켰다. 

---

## 2021-09-19

### <활동>

- 방에 들어가 게시글 작성하기 기능 구현
- 작성된 게시글 삭제하기 기능 구현

### <막혔던 점>

- 작성한 게시글이 어느 방의 게시글인지를 판단하는 것에서 생각이 많았다. 처음에는 room 테이블에 posts를 놓고 게시글을 작성하고 이를 room의 posts에 추가하려고 했는데 잘 되지 않았다. 다른 방법으로는 게시글을 작성하면 post 테이블에 현재 들어와있는 방의 정보를 저장하는 방법을 택했다. 자동으로 저장시키기 위해 post의 controller 코드 수정을 시도해봤지만 잘 되지 않았다.

> 해결: 그래서 post 테이블에 JSON형태로 room이라는 키를 두고 여기에 현재 있는 방의 정보를 store에서 불러와서 저장시켰다. 그리고 선택한 방에 들어가면 게시글을 불러오는 단계에서 post의 room의 id값과 현재 있는 방의 id값이 일치한 post들만 불러오도록 하였다.

---

## 2021-09-20

### <활동>

- 게시글 수정하기 기능 구현

---

## 2021-09-21

### <활동>

- 게시글 댓글 창 열고 닫기 기능 구현

### <막혔던 점>

- 게시글에 있는 댓글 버튼을 누르면 댓글 창이 열고 닫히도록 하려 했는데, 값을 변경해줘도 데이터 반영이 되지 않았다.

> 해결: 처음에는 this.comments[index] = !this.comments[index]로 값을 변경해 주었지만, data 안의 속성을 변경하면 vue가 감지하지 못한다는 사실을 알게되었다. 그래서 data 자체를 바꿔주도록 temp라는 변수에 comments를 slice로 복사해놓고 temp[index] = !temp[index]로 값을 바꿔주고 temp를 comments에 넣어주었다. 그랬더니 정상적으로 원하는대로 작동이 되었다.

![전](https://user-images.githubusercontent.com/52418706/134156382-b347d81a-b138-4528-b3fc-7e75e26050c4.JPG)  
<전>

![후](https://user-images.githubusercontent.com/52418706/134156408-3cb8639f-b580-4eaa-b978-7ed679940e95.JPG)  
<후>

